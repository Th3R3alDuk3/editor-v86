
<!doctype html>
<html>
    <head>

        <title>editor-v86-tcc</title>

        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="index.css">

    </head>
    <body>

        <script type="text/javascript" src="v86/libv86.js"></script>
        <script type="text/javascript">

            "use strict";
            
            window.onload = () => {

                var emulator = window.emulator = new V86Starter({
                    wasm_path: "v86/v86.wasm",
                    memory_size: 64 * 1024 * 1024,
                    vga_memory_size: 2 * 1024 * 1024,
                    screen_container: document.getElementById("screen_container"),
                    bios: {
                        url: "bios/seabios.bin",
                    },
                    vga_bios: {
                        url: "bios/vgabios.bin",
                    },
                    hda: {
                        url: "image/archlinux32.img",
                        async: true
                    },
                    autostart: true
                });

                var serial0 = document.getElementById("serial0");
                var serial0Ready = false;

                emulator.add_listener("serial0-output-line", (line) => {

                    if (line.startsWith("Last login:"))
                        serial0Ready = true;

                    if (serial0Ready)
                        serial0.value += line;
                    else
                        console.log(line);                        

                });
                
                var code = `#include <stdio.h>
                int main() {
                    printf("Hello World!\n");
                    for(int i = 0; i < 10; i++) {
                        printf("%d\n", i);
                    }
                }`;

                const interval = setInterval(function() {
                    if (serial0Ready) {
                        emulator.serial0_send("echo '" + code + "' |  tcc -run -\n");
                        clearInterval(interval);
                    }
                }, 1000);
                
            }

        </script>

        <div class="flex-container">

            <div class="flex-item1">
                <div id="screen_container">
                    <div style="white-space: pre; font: 14px monospace; line-height: 14px"></div>
                    <canvas style="display: none"></canvas>
                </div>
            </div>

            <div class="flex-item2">
                <textarea id="serial0"></textarea>
            </div>

        </div>
        
    </body>
</html>

